const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/progress-DpDmdcBQ.js","assets/index-CNtIdQN-.js","assets/index-0aggQXwr.css"])))=>i.map(i=>d[i]);
import{_ as Se,r as w,a as y,b as C,d as i,e as N,n as B,t as S,c as F,g as Q,w as be,F as xe,f as Re,h as L,i as re,o as ke,j as Te,k as Z,l as J,v as ee,m as Ae,u as De}from"./index-CNtIdQN-.js";import{u as ie}from"./decks-DpIHrgWe.js";import{u as ae}from"./progress-DpDmdcBQ.js";const te=["mixed","new-only","review-only","comparison-only"],se=["active","paused","completed","abandoned"];class O{constructor({id:t=null,deckIds:e=[],roundSize:s=50,newReviewRatio:a=50,sessionType:r="mixed",status:m="active",startTime:l=new Date,endTime:v=null,currentRound:f=1,totalRounds:g=1,cardsCompleted:x=0,cardsRemaining:R=0,currentCardIndex:$=0,sessionCards:D=[],retryCards:_=[],statistics:P=null,settings:k={},createdAt:b=new Date,updatedAt:d=new Date}={}){this.id=t||this.generateId(),this.deckIds=Array.isArray(e)?e:[],this.roundSize=s,this.newReviewRatio=a,this.sessionType=r,this.status=m,this.startTime=l,this.endTime=v,this.currentRound=f,this.totalRounds=g,this.cardsCompleted=x,this.cardsRemaining=R,this.currentCardIndex=$,this.sessionCards=Array.isArray(D)?D:[],this.retryCards=Array.isArray(_)?_:[],this.statistics=P||this.createDefaultStatistics(),this.settings=k||this.createDefaultSettings(),this.createdAt=b,this.updatedAt=d,this.validate()}generateId(){return`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}createDefaultStatistics(){return{totalCards:0,rememberedCards:0,forgottenCards:0,averageResponseTime:0,comparisonGroupsShown:0,newWordsLearned:0,reviewsCompleted:0,streak:0,startTime:new Date,timeSpent:0}}createDefaultSettings(){return{autoPlayAudio:!0,showHints:!0,gesturesEnabled:!0,animationsEnabled:!0}}validate(){const t=[];if(this.deckIds.length===0&&t.push("At least one deck ID is required"),(this.roundSize<1||this.roundSize>100)&&t.push("Round size must be between 1 and 100"),(this.newReviewRatio<0||this.newReviewRatio>100)&&t.push("New/review ratio must be between 0 and 100"),te.includes(this.sessionType)||t.push(`Session type must be one of: ${te.join(", ")}`),se.includes(this.status)||t.push(`Status must be one of: ${se.join(", ")}`),(this.currentRound<1||this.currentRound>this.totalRounds)&&t.push("Current round must be between 1 and total rounds"),(this.cardsCompleted<0||this.cardsRemaining<0)&&t.push("Card counts cannot be negative"),t.length>0)throw new Error(`StudySession validation failed: ${t.join("; ")}`)}get totalCards(){return this.sessionCards.length}get progressPercentage(){return this.totalCards>0?this.cardsCompleted/this.totalCards*100:0}get isComplete(){return this.status==="completed"||this.currentCardIndex>=this.sessionCards.length}get currentCard(){return this.currentCardIndex>=this.sessionCards.length?null:this.sessionCards[this.currentCardIndex]}get estimatedTimeRemaining(){if(this.cardsRemaining===0)return 0;const t=this.statistics.averageResponseTime||3;return Math.round(this.cardsRemaining*t/60)}get sessionDuration(){const t=this.endTime||new Date;return Math.round((t-this.startTime)/(1e3*60))}initializeCards(t){const e=this.sortCardsByDifficulty(t),{newCards:s,reviewCards:a}=this.categorizeCards(e),r=this.applyNewReviewRatio(s,a);return this.sessionCards=this.organizeIntoRounds(r),this.cardsRemaining=this.sessionCards.length,this.totalRounds=Math.ceil(this.sessionCards.length/this.roundSize),this.statistics.totalCards=this.sessionCards.length,this.updatedAt=new Date,this}sortCardsByDifficulty(t){const e={new:t.filter(r=>r.difficulty==="new"),easy:t.filter(r=>r.difficulty==="easy"),medium:t.filter(r=>r.difficulty==="medium"),hard:t.filter(r=>r.difficulty==="hard")};Object.keys(e).forEach(r=>{e[r]=this.shuffleArray([...e[r]])});const s=[],a=Math.max(e.easy.length,e.medium.length,e.hard.length);for(let r=0;r<a;r++)e.easy[r]&&s.push(e.easy[r]),e.medium[r]&&s.push(e.medium[r]),e.hard[r]&&s.push(e.hard[r]);return[...e.new,...s]}categorizeCards(t){return{newCards:t.filter(e=>e.difficulty==="new"),reviewCards:t.filter(e=>e.difficulty!=="new")}}applyNewReviewRatio(t,e){const s=Math.min(this.roundSize*this.totalRounds,t.length+e.length),a=Math.round(this.newReviewRatio/100*s),r=s-a,m=t.slice(0,Math.min(a,t.length)),l=e.slice(0,Math.min(r,e.length));return[...m,...l]}organizeIntoRounds(t){return t}shuffleArray(t){const e=[...t];for(let s=e.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[e[s],e[a]]=[e[a],e[s]]}return e}advanceToNextCard(){return this.currentCardIndex<this.sessionCards.length-1?(this.currentCardIndex++,this.cardsCompleted++,this.cardsRemaining=this.sessionCards.length-this.cardsCompleted,this.cardsCompleted%this.roundSize===0&&this.cardsCompleted<this.sessionCards.length&&this.currentRound++):this.completeSession(),this.updatedAt=new Date,this}recordCardResult(t,e,s=0){return this.statistics.averageResponseTime=this.calculateAverageResponseTime(s),e==="remember"?this.statistics.rememberedCards++:(this.statistics.forgottenCards++,this.scheduleRetry(t)),this.advanceToNextCard(),this}calculateAverageResponseTime(t){const e=this.statistics.rememberedCards+this.statistics.forgottenCards;return((this.statistics.averageResponseTime||0)*e+t)/(e+1)}scheduleRetry(t,e=10){const s=new Date;s.setMinutes(s.getMinutes()+e);const a={cardId:t,scheduledFor:s,remainingTime:e*60};return this.retryCards.push(a),this.updatedAt=new Date,this}getRetryCards(){const t=new Date;return this.retryCards.map(e=>({...e,remainingTime:Math.max(0,Math.floor((e.scheduledFor-t)/1e3)),isReady:t>=e.scheduledFor}))}skipRetryWait(t=null){return t?this.retryCards=this.retryCards.filter(e=>e.cardId!==t):this.retryCards=[],this.updatedAt=new Date,this}pauseSession(){return this.status==="active"&&(this.status="paused",this.updatedAt=new Date),this}resumeSession(){return this.status==="paused"&&(this.status="active",this.updatedAt=new Date),this}completeSession(){return this.status="completed",this.endTime=new Date,this.statistics.timeSpent=this.sessionDuration,this.updatedAt=new Date,this}abandonSession(){return this.status="abandoned",this.endTime=new Date,this.statistics.timeSpent=this.sessionDuration,this.updatedAt=new Date,this}undoLastAction(){return this.cardsCompleted>0?(this.currentCardIndex=Math.max(0,this.currentCardIndex-1),this.cardsCompleted--,this.cardsRemaining++,this.currentRound=Math.floor(this.cardsCompleted/this.roundSize)+1,this.updatedAt=new Date,{success:!0,cardIndex:this.currentCardIndex}):{success:!1,message:"No actions to undo"}}toJSON(){var t;return{id:this.id,deckIds:this.deckIds,roundSize:this.roundSize,newReviewRatio:this.newReviewRatio,sessionType:this.sessionType,status:this.status,startTime:this.startTime.toISOString(),endTime:((t=this.endTime)==null?void 0:t.toISOString())||null,currentRound:this.currentRound,totalRounds:this.totalRounds,cardsCompleted:this.cardsCompleted,cardsRemaining:this.cardsRemaining,currentCardIndex:this.currentCardIndex,sessionCards:this.sessionCards,retryCards:this.retryCards,statistics:this.statistics,settings:this.settings,createdAt:this.createdAt.toISOString(),updatedAt:this.updatedAt.toISOString(),totalCards:this.totalCards,progressPercentage:this.progressPercentage,isComplete:this.isComplete,estimatedTimeRemaining:this.estimatedTimeRemaining,sessionDuration:this.sessionDuration}}static fromJSON(t){return new O({...t,startTime:new Date(t.startTime),endTime:t.endTime?new Date(t.endTime):null,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)})}static createNew(t,e={}){return new O({deckIds:t,...e})}}const $e=[{name:"Animals with CH sound",category:"phonetic",words:["chat","chien","cheval"],description:"French animals starting with CH"},{name:"Colors - Primary",category:"meaning",words:["rouge","bleu","vert"],description:"Basic color words"},{name:"Size adjectives",category:"meaning",words:["grand","petit"],description:"Opposite size descriptions"},{name:"Essential verbs",category:"grammar",words:["Ãªtre","avoir","aller","faire"],description:"Most common French verbs"},{name:"Greetings",category:"meaning",words:["bonjour","bonsoir","salut"],description:"Different greeting expressions"}];class Ie{constructor(){this.currentSession=null,this.decksStore=null,this.progressStore=null}initializeStores(){this.decksStore||(this.decksStore=ie()),this.progressStore||(this.progressStore=ae())}async createSession(t){try{this.initializeStores();const{deckIds:e,roundSize:s=50,newReviewRatio:a=50,sessionType:r="mixed"}=t;if(!e||e.length===0)return{success:!1,error:"No decks selected for study"};const m=[];for(const v of e){const f=this.decksStore.getDeckWithCards(v);f!=null&&f.wordCards&&m.push(...f.wordCards.map(g=>({...g,deckId:v,difficulty:this.getWordDifficulty(g.id)})))}if(m.length===0)return{success:!1,error:"No cards available in selected decks"};this.currentSession=new O({deckIds:e,roundSize:s,newReviewRatio:a,sessionType:r}),this.currentSession.initializeCards(m);const l=Math.round(this.currentSession.totalCards*3/60);return this.saveSessionToPersistence(),{success:!0,session:{id:this.currentSession.id,totalCards:this.currentSession.totalCards,totalRounds:this.currentSession.totalRounds,estimatedTime:l}}}catch(e){return{success:!1,error:e.message}}}async getNextCard(){try{if(!this.currentSession)return{type:"session-complete",sessionSummary:null};const e=this.currentSession.getRetryCards().filter(r=>r.isReady);if(e.length>0){const r=e[0],m=this.currentSession.sessionCards.find(l=>l.id===r.cardId);if(m)return{type:"single",data:{cards:[m],progress:{currentPosition:this.currentSession.cardsCompleted+1,totalCards:this.currentSession.totalCards,roundProgress:this.currentSession.cardsCompleted%this.currentSession.roundSize+1,roundTotal:this.currentSession.roundSize},isRetry:!0}}}if(this.currentSession.isComplete)return{type:"session-complete",sessionSummary:this.generateSessionSummary()};const s=this.currentSession.currentCard;if(!s)return{type:"session-complete",sessionSummary:this.generateSessionSummary()};const a=this.getComparisonGroup(s);return a&&a.length>1?{type:"comparison",data:{cards:a,progress:{currentPosition:this.currentSession.cardsCompleted+1,totalCards:this.currentSession.totalCards,roundProgress:this.currentSession.cardsCompleted%this.currentSession.roundSize+1,roundTotal:this.currentSession.roundSize}}}:{type:"single",data:{cards:[s],progress:{currentPosition:this.currentSession.cardsCompleted+1,totalCards:this.currentSession.totalCards,roundProgress:this.currentSession.cardsCompleted%this.currentSession.roundSize+1,roundTotal:this.currentSession.roundSize}}}}catch(t){return{type:"error",error:t.message}}}async recordCardResult(t,e){try{if(this.initializeStores(),!this.currentSession)return{success:!1,error:"No active session"};const{action:s,responseTime:a=0,sessionType:r="normal"}=e;this.currentSession.recordCardResult(t,s,a);const m=this.progressStore.recordWordReview(t,s,a);let l=null;return s==="not-remember"&&(this.currentSession.scheduleRetry(t,10),l={retryIn:10}),this.saveSessionToPersistence(),{success:!0,nextReview:m.nextReview,retryIn:(l==null?void 0:l.retryIn)||null}}catch(s){return{success:!1,error:s.message}}}async pauseSession(){try{return this.currentSession?(this.currentSession.pauseSession(),this.saveSessionToPersistence(),{success:!0,resumeToken:this.currentSession.id}):{success:!1,error:"No active session"}}catch(t){return{success:!1,error:t.message}}}async resumeSession(t=null){try{const e=this.loadSessionFromPersistence();if(!e)return{success:!1,error:"No session to resume"};if(this.currentSession=O.fromJSON(e),t&&this.currentSession.id!==t)return{success:!1,error:"Invalid resume token"};this.currentSession.resumeSession();const s=this.currentSession.getRetryCards();return{success:!0,session:this.currentSession.toJSON(),hasRetryCards:s.length>0,retryCards:s.map(a=>({cardId:a.cardId,availableAt:a.scheduledFor}))}}catch(e){return{success:!1,error:e.message}}}async completeSession(){try{if(!this.currentSession)return{summary:this.getDefaultSummary()};this.currentSession.completeSession();const t=this.generateSessionSummary();return this.clearSessionFromPersistence(),this.currentSession=null,{summary:t}}catch(t){return{summary:this.getDefaultSummary(),error:t.message}}}async undoLastAction(){try{if(!this.currentSession)return{success:!1,message:"No active session"};const t=this.currentSession.undoLastAction();if(t.success){this.saveSessionToPersistence();const e=this.currentSession.currentCard;return{success:!0,restoredCard:{cardId:(e==null?void 0:e.id)||null,previousResult:null}}}return t}catch(t){return{success:!1,message:t.message}}}async getRetryCards(){try{return this.currentSession?{retryCards:this.currentSession.getRetryCards().map(e=>({cardId:e.cardId,word:this.getWordFromCard(e.cardId),availableAt:e.scheduledFor,remainingTime:e.remainingTime}))}:{retryCards:[]}}catch{return{retryCards:[]}}}async skipRetryWait(t=null){try{if(!this.currentSession)return{success:!1,cardsReady:0};const e=this.currentSession.retryCards.length;this.currentSession.skipRetryWait(t);const s=this.currentSession.retryCards.length;return this.saveSessionToPersistence(),{success:!0,cardsReady:e-s}}catch(e){return{success:!1,cardsReady:0,error:e.message}}}async calculateNextReview(t,e){try{const s=new(await Se(async()=>{const{ProgressEntry:a}=await import("./progress-DpDmdcBQ.js").then(r=>r.P);return{ProgressEntry:a}},__vite__mapDeps([0,1,2]))).ProgressEntry({wordId:"temp",reviewCount:t.reviewCount||0,easeFactor:t.easeFactor||2.5,currentInterval:t.currentInterval||1,lastResult:t.lastResult});return s.calculateNextReview(e),{nextInterval:s.currentInterval,nextReviewDate:s.nextReviewDate,newEaseFactor:s.easeFactor,difficulty:s.difficulty}}catch{const a=e==="remember"?Math.max(1,(t.currentInterval||1)*2):1,r=new Date;return r.setDate(r.getDate()+a),{nextInterval:a,nextReviewDate:r,newEaseFactor:t.easeFactor||2.5,difficulty:a<=3?"hard":a<=7?"medium":"easy"}}}getWordDifficulty(t){this.initializeStores();const e=this.progressStore.getProgressForWord(t);return(e==null?void 0:e.difficulty)||"new"}getComparisonGroup(t){for(const e of $e)if(e.words.includes(t.word)){const s=this.currentSession.sessionCards.filter(a=>e.words.includes(a.word));if(s.length>=2)return s}return null}generateSessionSummary(){var e,s;if(!this.currentSession)return this.getDefaultSummary();const t=this.currentSession.statistics;return{totalCards:t.totalCards||0,rememberedCards:t.rememberedCards||0,forgottenCards:t.forgottenCards||0,timeSpent:this.currentSession.sessionDuration,averageResponseTime:t.averageResponseTime||0,comparisonGroupsShown:t.comparisonGroupsShown||0,newWordsLearned:t.newWordsLearned||0,streak:((s=(e=this.progressStore)==null?void 0:e.streakData)==null?void 0:s.currentStreak)||0}}getDefaultSummary(){return{totalCards:0,rememberedCards:0,forgottenCards:0,timeSpent:0,averageResponseTime:0,comparisonGroupsShown:0,newWordsLearned:0,streak:0}}getWordFromCard(t){if(!this.currentSession)return"Unknown";const e=this.currentSession.sessionCards.find(s=>s.id===t);return(e==null?void 0:e.word)||"Unknown"}saveSessionToPersistence(){this.currentSession&&localStorage.setItem("word-app-session",JSON.stringify(this.currentSession.toJSON()))}loadSessionFromPersistence(){const t=localStorage.getItem("word-app-session");return t?JSON.parse(t):null}clearSessionFromPersistence(){localStorage.removeItem("word-app-session")}}const z=new Ie;class Pe{constructor(){this.audioCache=new Map,this.settings={enabled:!0,autoPlay:!0,voice:"female",volume:80,playbackRate:1},this.maxCacheSize=50*1024*1024,this.currentCacheSize=0,this.loadSettings()}async playWordAudio(t,e="fr",s=null){try{if(!this.settings.enabled)return{success:!1,source:"disabled",error:"Audio is disabled"};const a=s||this.settings.voice,r=`${t}-${e}-${a}`,m=this.getFromCache(r);if(m.found)return await this.playAudioBlob(m.audioBlob),{success:!0,source:"cache"};const l=await this.generateTTS(t,{language:e,voice:a,rate:this.settings.playbackRate,pitch:1});return l.success?(this.cacheAudioBlob(r,l.audioBlob,{source:"tts",language:e,voice:a,quality:80,createdAt:new Date}),await this.playAudioBlob(l.audioBlob),{success:!0,source:"tts"}):{success:!1,source:"tts",error:l.error}}catch(a){return{success:!1,source:"error",error:a.message}}}async preloadAudio(t,e=5,s="fr"){try{const a={success:!0,cached:0,failed:[],fromCache:0};for(const r of t){const m=`${r}-${s}-${this.settings.voice}`;if(this.getFromCache(m).found){a.fromCache++;continue}try{const l=await this.generateTTS(r,{language:s,voice:this.settings.voice,rate:this.settings.playbackRate,pitch:1});l.success?(this.cacheAudioBlob(m,l.audioBlob,{source:"tts",language:s,voice:this.settings.voice,quality:80,createdAt:new Date}),a.cached++):a.failed.push(r)}catch{a.failed.push(r)}}return a}catch(a){return{success:!1,cached:0,failed:t,fromCache:0,error:a.message}}}async setAudioSettings(t){try{const e=this.validateSettings(t);return this.settings={...this.settings,...e},this.saveSettings(),{success:!0}}catch(e){return{success:!1,error:e.message}}}async getAudioSettings(){return{...this.settings}}async clearAudioCache(){try{const t=this.currentCacheSize;return this.audioCache.clear(),this.currentCacheSize=0,{success:!0,freedBytes:t}}catch(t){return{success:!1,freedBytes:0,error:t.message}}}async getCacheStatus(){const t=Array.from(this.audioCache.values());return{totalItems:this.audioCache.size,totalBytes:this.currentCacheSize,maxBytes:this.maxCacheSize,hitRate:this.calculateHitRate(),oldestItem:t.length>0?Math.min(...t.map(e=>e.metadata.createdAt.getTime())):null,newestItem:t.length>0?Math.max(...t.map(e=>e.metadata.createdAt.getTime())):null}}async generateTTS(t,e){try{const{language:s="fr",voice:a="female",rate:r=1,pitch:m=1}=e;if(!("speechSynthesis"in window))return{success:!1,error:"Speech synthesis not supported"};const l=await this.getAvailableVoices(s);let v=null;return l.voices.length>0&&(v=l.voices.find(f=>f.gender===a||f.isDefault)||l.voices[0]),new Promise(f=>{const g=new SpeechSynthesisUtterance(t);g.lang=this.getLanguageCode(s),g.rate=r,g.pitch=m,g.volume=this.settings.volume/100,v&&(g.voice=v.voice);let x=null,R=0;g.onstart=()=>{R=Date.now()},g.onend=()=>{R=(Date.now()-R)/1e3,x=new Blob([t],{type:"audio/wav"}),f({success:!0,audioBlob:x,duration:R})},g.onerror=$=>{f({success:!1,error:$.error||"Speech synthesis failed"})},speechSynthesis.speak(g)})}catch(s){return{success:!1,error:s.message}}}async getAvailableVoices(t){try{return"speechSynthesis"in window?new Promise(e=>{let s=speechSynthesis.getVoices();s.length===0?speechSynthesis.onvoiceschanged=()=>{s=speechSynthesis.getVoices(),e(this.formatVoices(s,t))}:e(this.formatVoices(s,t))}):{voices:[]}}catch{return{voices:[]}}}formatVoices(t,e){const s=this.getLanguageCode(e);return{voices:t.filter(r=>r.lang.startsWith(s.split("-")[0])).map(r=>({name:r.name,gender:this.detectVoiceGender(r.name),quality:r.localService?"high":"medium",isDefault:r.default,voice:r}))}}async cacheAudioBlob(t,e,s){try{const a=e.size||1024;this.currentCacheSize+a>this.maxCacheSize&&this.evictLeastRecent(Math.ceil(a/(1024*1024)));const r={audioBlob:e,metadata:{...s,createdAt:new Date(s.createdAt),lastAccessed:new Date,accessCount:0}};return this.audioCache.set(t,r),this.currentCacheSize+=a,{success:!0,cacheKey:t}}catch(a){return{success:!1,error:a.message}}}getFromCache(t){const e=this.audioCache.get(t);return e?(e.metadata.lastAccessed=new Date,e.metadata.accessCount++,{found:!0,audioBlob:e.audioBlob,metadata:e.metadata,lastAccessed:e.metadata.lastAccessed}):{found:!1}}evictLeastRecent(t){const e=Array.from(this.audioCache.entries()).sort((m,l)=>m[1].metadata.lastAccessed-l[1].metadata.lastAccessed);let s=0,a=0;const r=t*1024*1024;for(const[m,l]of e){if(a>=r)break;const v=l.audioBlob.size||1024;this.audioCache.delete(m),this.currentCacheSize-=v,a+=v,s++}return{evicted:s,freedBytes:a}}async playAudioBlob(t){return new Promise((e,s)=>{setTimeout(e,100)})}validateSettings(t){const e={};return t.enabled!==void 0&&(e.enabled=!!t.enabled),t.autoPlay!==void 0&&(e.autoPlay=!!t.autoPlay),t.voice!==void 0&&["male","female"].includes(t.voice)&&(e.voice=t.voice),t.volume!==void 0&&(e.volume=Math.max(0,Math.min(100,Number(t.volume)))),t.playbackRate!==void 0&&(e.playbackRate=Math.max(.5,Math.min(2,Number(t.playbackRate)))),e}getLanguageCode(t){return{fr:"fr-FR",en:"en-US",es:"es-ES",de:"de-DE",it:"it-IT"}[t]||"fr-FR"}detectVoiceGender(t){const e=t.toLowerCase(),s=["female","woman","marie","amelie","claire","samantha","anna"],a=["male","man","pierre","henri","thomas","alex","daniel"];return s.some(r=>e.includes(r))?"female":a.some(r=>e.includes(r))?"male":"unknown"}calculateHitRate(){const t=Array.from(this.audioCache.values());if(t.length===0)return 0;const e=t.reduce((s,a)=>s+a.metadata.accessCount,0);return t.length>0?e/t.length*100:0}saveSettings(){localStorage.setItem("word-app-audio-settings",JSON.stringify(this.settings))}loadSettings(){const t=localStorage.getItem("word-app-audio-settings");if(t)try{this.settings={...this.settings,...JSON.parse(t)}}catch(e){console.warn("Failed to load audio settings:",e)}}}const K=new Pe,ne=(c,t)=>{const e=c.__vccOpts||c;for(const[s,a]of t)e[s]=a;return e},ze={class:"flex-grow flex flex-col justify-center text-center mb-6"},_e=["aria-label"],Me={class:"text-4xl font-bold mb-2"},Ne={class:"text-lg text-muted-foreground"},Fe={key:0,class:"mt-4 text-muted-foreground text-sm italic"},Be={key:1,class:"mt-6"},Ee={class:"text-2xl font-semibold mb-2"},We={class:"flex-shrink-0"},Oe={key:1,class:"grid grid-cols-2 gap-3"},Ve={class:"text-xs text-muted-foreground text-center mt-3 md:hidden"},Le={key:0},je={key:1},Ge={__name:"WordCard",props:{wordCard:{type:Object,required:!0},revealed:{type:Boolean,default:!1},audioPlaying:{type:Boolean,default:!1}},emits:["audio-play","reveal","card-action"],setup(c,{emit:t}){const e=c,s=t,a=w(null),r=w(null);function m(v){a.value={x:v.touches[0].clientX,y:v.touches[0].clientY,time:Date.now()}}function l(v){if(!a.value||!e.revealed)return;r.value={x:v.changedTouches[0].clientX,y:v.changedTouches[0].clientY,time:Date.now()};const f=r.value.x-a.value.x,g=r.value.y-a.value.y,x=r.value.time-a.value.time;Math.abs(f)<50&&Math.abs(g)<50||x>300||(Math.abs(g)>Math.abs(f)?g<-50&&s("card-action",e.wordCard.id,"remember"):f<-50&&s("card-action",e.wordCard.id,"not-remember"),a.value=null,r.value=null)}return(v,f)=>(C(),y("div",{class:B(["bg-card rounded-lg border shadow-lg p-6 min-h-[400px] flex flex-col touch-target card-transition",{"audio-playing":c.audioPlaying}]),"data-testid":"word-card",onTouchstart:m,onTouchend:l},[i("div",ze,[i("div",{class:B(["cursor-pointer select-none hover:text-primary transition-colors",{"text-primary scale-105":c.audioPlaying}]),"data-testid":"word","aria-label":`Click to hear pronunciation of ${c.wordCard.word}`,onClick:f[0]||(f[0]=g=>v.$emit("audio-play",c.wordCard.id))},[i("h1",Me,S(c.wordCard.word),1),i("div",Ne,S(c.wordCard.partOfSpeech),1)],10,_e),c.revealed&&c.wordCard.hint?(C(),y("div",Fe,S(c.wordCard.hint),1)):N("",!0),c.revealed?(C(),y("div",Be,[i("h2",Ee,S(c.wordCard.translation),1)])):N("",!0)]),i("div",We,[c.revealed?(C(),y("div",Oe,[i("button",{onClick:f[2]||(f[2]=g=>v.$emit("card-action",c.wordCard.id,"not-remember")),"data-testid":"not-remember-button",class:"bg-red-500 text-white hover:bg-red-600 rounded-md px-4 py-3 font-medium transition-colors touch-target"}," Not Remember "),i("button",{onClick:f[3]||(f[3]=g=>v.$emit("card-action",c.wordCard.id,"remember")),"data-testid":"remember-button",class:"bg-green-500 text-white hover:bg-green-600 rounded-md px-4 py-3 font-medium transition-colors touch-target"}," Remember ")])):(C(),y("button",{key:0,onClick:f[1]||(f[1]=g=>v.$emit("reveal")),"data-testid":"reveal-button",class:"w-full bg-primary text-primary-foreground hover:bg-primary/90 rounded-md px-4 py-3 font-medium transition-colors touch-target"}," Reveal Answer "))]),i("div",Ve,[c.revealed?(C(),y("div",je,"Swipe â Remember â¢ Swipe â Not Remember")):(C(),y("div",Le,"Tap word for audio â¢ Tap button to reveal"))])],34))}},Ue=ne(Ge,[["__scopeId","data-v-76edee14"]]),He={class:"text-center mb-6"},Je={class:"text-sm text-muted-foreground"},Ke=["aria-label","onClick","onKeydown"],qe={class:"text-center"},Ye=["onClick"],Xe={class:"text-2xl font-bold mb-1"},Qe={class:"text-sm text-muted-foreground"},Ze=["data-testid"],et={key:1,class:"mt-4"},tt={class:"text-lg font-medium mb-2"},st={key:0,class:"text-sm text-muted-foreground italic"},rt={class:"mt-4"},it=["onClick","data-testid"],at={key:1,class:"grid grid-cols-2 gap-2"},nt=["onClick","data-testid","disabled"],ot=["onClick","data-testid","disabled"],dt={key:2,class:"mt-2"},lt={class:"progress-section"},ct={class:"flex justify-between items-center mb-2 text-sm"},ut={class:"bg-muted h-2 rounded-full overflow-hidden"},ht={__name:"ComparisonMode",props:{wordCards:{type:Array,required:!0,validator:c=>c.length>=2&&c.length<=6},highlightedCardId:{type:String,default:null},revealedCards:{type:Set,default:()=>new Set},completedCards:{type:Set,default:()=>new Set},audioPlayingCardId:{type:String,default:null}},emits:["card-highlight","card-reveal","card-action","audio-play","audio-stop","group-complete"],setup(c,{emit:t}){const e=c,s=t,a=w(""),r=w(""),m=F(()=>({"mobile-single-column":window.innerWidth<640,"tablet-two-columns":window.innerWidth>=640&&window.innerWidth<1024,"desktop-grid":window.innerWidth>=1024})),l=F(()=>{const d=e.wordCards.length;return window.innerWidth<640?"flex flex-col":window.innerWidth<1024?(d<=2,"grid grid-cols-2"):d<=2?"grid grid-cols-2":d<=3?"grid grid-cols-3":d<=4?"grid grid-cols-2":"grid grid-cols-3"}),v=F(()=>{const d=e.wordCards.length,h=e.completedCards.size;return d>0?h/d*100:0});function f(d,h){return{highlighted:g(d),completed:e.completedCards.has(d),"ring-2 ring-primary":g(d),"opacity-75":e.completedCards.has(d)}}function g(d){return e.highlightedCardId===d}function x(d){s("card-highlight",d),R(d),k(d)}function R(d){e.audioPlayingCardId&&s("audio-stop"),s("audio-play",d)}function $(d){s("card-reveal",d);const h=e.wordCards.find(u=>u.id===d);h&&b(`Revealed: ${h.word} means ${h.translation}`)}function D(d,h){s("card-action",d,h),Q(()=>{e.completedCards.size===e.wordCards.length&&(s("group-complete"),b("All words in this group completed!"))})}function _(d,h){switch(d.key){case"Enter":case" ":d.preventDefault(),e.revealedCards.has(h)||$(h);break;case"ArrowRight":d.preventDefault(),P(h,1);break;case"ArrowLeft":d.preventDefault(),P(h,-1);break;case"ArrowUp":d.preventDefault(),e.revealedCards.has(h)&&D(h,"remember");break;case"ArrowDown":d.preventDefault(),e.revealedCards.has(h)&&D(h,"not-remember");break}}function P(d,h){const T=(e.wordCards.findIndex(E=>E.id===d)+h+e.wordCards.length)%e.wordCards.length,A=e.wordCards[T];A&&x(A.id)}function k(d){const h=e.wordCards.find(T=>T.id===d),u=e.wordCards.findIndex(T=>T.id===d)+1;h&&b(`Card ${u}: ${h.word}`)}function b(d){r.value=d,setTimeout(()=>{r.value=""},2e3)}return e.wordCards.length>0&&!e.highlightedCardId&&Q(()=>{s("card-highlight",e.wordCards[0].id)}),be(()=>e.completedCards.size,d=>{d===e.wordCards.length&&d>0&&b("Comparison group completed successfully!")}),(d,h)=>(C(),y("div",{class:B(["comparison-container w-full max-w-4xl mx-auto",m.value]),"data-testid":"comparison-container","aria-label":"Comparison mode - practice similar words together"},[i("div",He,[h[0]||(h[0]=i("h2",{class:"text-lg font-semibold mb-2"},"Compare Similar Words",-1)),i("p",Je," Study these "+S(c.wordCards.length)+" similar words together ",1)]),i("div",{class:B(["cards-grid gap-4 mb-6",l.value])},[(C(!0),y(xe,null,Re(c.wordCards,(u,T)=>(C(),y("div",{key:u.id,class:B(["comparison-card bg-card border rounded-lg p-4 transition-all duration-200 cursor-pointer touch-target",f(u.id)]),"data-testid":"comparison-card",role:"button","aria-label":`Word ${T+1}: ${u.word}`,tabindex:0,onClick:A=>x(u.id),onKeydown:A=>_(A,u.id)},[i("div",qe,[i("div",{class:B(["word-display cursor-pointer select-none transition-colors",{"text-primary scale-105":g(u.id)&&c.audioPlayingCardId===u.id}]),onClick:L(A=>R(u.id),["stop"])},[i("h3",Xe,S(u.word),1),i("div",Qe,S(u.partOfSpeech),1)],10,Ye),c.audioPlayingCardId===u.id?(C(),y("div",{key:0,class:"audio-indicator playing mt-2","data-testid":`audio-indicator-${u.id}`},[...h[1]||(h[1]=[i("div",{class:"flex justify-center"},[i("div",{class:"w-2 h-2 bg-primary rounded-full animate-pulse"})],-1)])],8,Ze)):N("",!0),c.revealedCards.has(u.id)?(C(),y("div",et,[i("div",tt,S(u.translation),1),u.hint?(C(),y("div",st,S(u.hint),1)):N("",!0)])):N("",!0),i("div",rt,[c.revealedCards.has(u.id)?(C(),y("div",at,[i("button",{onClick:L(A=>D(u.id,"not-remember"),["stop"]),"data-testid":`not-remember-button-${u.id}`,disabled:c.completedCards.has(u.id),class:"bg-red-500 text-white hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-md px-3 py-2 text-sm font-medium transition-colors touch-target"}," Don't Know ",8,nt),i("button",{onClick:L(A=>D(u.id,"remember"),["stop"]),"data-testid":`remember-button-${u.id}`,disabled:c.completedCards.has(u.id),class:"bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-md px-3 py-2 text-sm font-medium transition-colors touch-target"}," Know ",8,ot)])):(C(),y("button",{key:0,onClick:L(A=>$(u.id),["stop"]),"data-testid":`reveal-button-${u.id}`,class:"w-full bg-primary text-primary-foreground hover:bg-primary/90 rounded-md px-3 py-2 text-sm font-medium transition-colors touch-target"}," Reveal ",8,it))]),c.completedCards.has(u.id)?(C(),y("div",dt,[...h[2]||(h[2]=[i("div",{class:"text-xs text-green-600 font-medium"},"â Completed",-1)])])):N("",!0)])],42,Ke))),128))],2),i("div",lt,[i("div",ct,[h[3]||(h[3]=i("span",null,"Group Progress",-1)),i("span",null,S(c.completedCards.size)+"/"+S(c.wordCards.length),1)]),i("div",ut,[i("div",{class:"bg-primary h-full transition-all duration-300",style:re({width:`${v.value}%`})},null,4)])]),h[4]||(h[4]=i("div",{class:"instructions text-center mt-4 text-sm text-muted-foreground"},[i("div",{class:"hidden md:block"}," Click cards to hear pronunciation â¢ Use arrow keys to navigate "),i("div",{class:"md:hidden"}," Tap cards to hear pronunciation â¢ Tap buttons to answer ")],-1)),i("div",{class:"sr-only","aria-live":"polite",ref_key:"announcements",ref:a},S(r.value),513)],2))}},mt=ne(ht,[["__scopeId","data-v-a58055eb"]]),ft={class:"min-h-screen bg-background"},gt={class:"bg-card border-b px-4 py-3"},vt={class:"flex justify-between items-center max-w-md mx-auto"},pt={class:"text-center"},yt={class:"text-sm font-medium"},Ct={class:"text-xs text-muted-foreground"},wt={class:"bg-muted h-1"},St={key:0,class:"bg-yellow-50 border-b border-yellow-200 px-4 py-2"},bt={class:"flex justify-between items-center max-w-md mx-auto text-sm"},xt={class:"text-yellow-800"},Rt={class:"space-x-2"},kt={class:"flex-1 flex items-center justify-center p-4"},Tt={key:0,class:"text-center"},At={key:1,class:"w-full"},Dt={key:2,class:"w-full max-w-md"},$t={key:3,class:"text-center max-w-md mx-auto"},It={class:"bg-card rounded-lg border p-6 mb-6"},Pt={class:"grid grid-cols-2 gap-4 text-center mb-4"},zt={class:"text-2xl font-bold text-green-600"},_t={class:"text-2xl font-bold text-red-600"},Mt={class:"text-sm text-muted-foreground space-y-1"},Nt={key:4,class:"text-center"},Ft={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"},Bt={class:"bg-background rounded-lg max-w-md w-full p-6"},Et={class:"flex justify-between items-center mb-4"},Wt={class:"space-y-4"},Ot={class:"flex items-center justify-between"},Vt={class:"flex items-center justify-between"},Lt={class:"space-y-2"},Ht={__name:"StudyView",setup(c){const t=De(),e=ie(),s=ae(),a=w(!0),r=w(null),m=w([]),l=w("single"),v=w(!1),f=w(!1),g=w(null),x=w(!1),R=w(!1),$=w(null),D=w(new Set),_=w(new Set),P=w(null),k=w([]),b=w({rememberedCards:0,forgottenCards:0,timeSpent:0,averageResponseTime:0,streak:0}),d=w(!0),h=w(!0),u=w("female"),T=w(null),A=F(()=>{var o;return((o=P.value)==null?void 0:o.cardsCompleted)+1||1}),E=F(()=>{var o;return((o=P.value)==null?void 0:o.totalCards)||0}),oe=F(()=>{var o;return((o=P.value)==null?void 0:o.cardsRemaining)||0}),de=F(()=>E.value>0?(A.value-1)/E.value*100:0);async function le(){a.value=!0;try{s.loadFromPersistence();const o=e.getAvailableDecksForStudy;if(o.length===0){x.value=!0,a.value=!1;return}const n=await z.createSession({deckIds:o.map(p=>p.id),roundSize:20,newReviewRatio:80,sessionType:"mixed"});if(!n.success){console.error("Failed to create session:",n.error),x.value=!0,a.value=!1;return}P.value=n.session,await W()}catch(o){console.error("Session initialization failed:",o),x.value=!0}finally{a.value=!1}}async function W(){var o,n,p,M,X;try{const I=await z.getNextCard();if(I.type==="session-complete"){await G(I.sessionSummary);return}I.type==="comparison"&&((n=(o=I.data)==null?void 0:o.cards)==null?void 0:n.length)>1?(l.value="comparison",m.value=I.data.cards,r.value=null,$.value=((p=m.value[0])==null?void 0:p.id)||null,D.value=new Set,_.value=new Set,T.value=Date.now()):I.type==="single"&&((X=(M=I.data)==null?void 0:M.cards)==null?void 0:X.length)>0?(l.value="single",r.value=I.data.cards[0],m.value=[],v.value=!1,T.value=Date.now(),d.value&&r.value&&setTimeout(()=>V(r.value.id),500)):await G();const we=await z.getRetryCards();k.value=we.retryCards}catch(I){console.error("Failed to load next card:",I),await G()}}function q(){v.value=!0}async function j(o,n){if(!(!r.value||o!==r.value.id))try{const p=T.value?(Date.now()-T.value)/1e3:0,M=await z.recordCardResult(o,{action:n,responseTime:p,sessionType:"normal"});M.success?(n==="remember"?b.value.rememberedCards++:b.value.forgottenCards++,setTimeout(()=>{W()},300)):console.error("Failed to record card result:",M.error)}catch(p){console.error("Error handling card action:",p),setTimeout(()=>{W()},300)}}async function V(o=null){let n;if(l.value==="comparison"?(n=m.value.find(p=>p.id===o),g.value=o):n=r.value,!!(n!=null&&n.word)){f.value=!0;try{const p=await K.playWordAudio(n.word,"fr",u.value);setTimeout(()=>{f.value=!1,g.value=null},1500)}catch(p){console.error("Audio playback failed:",p),f.value=!1,g.value=null}}}function ce(){f.value=!1,g.value=null}function ue(o){$.value=o}function he(o){D.value.add(o)}async function me(o,n){try{const p=T.value?(Date.now()-T.value)/1e3:0,M=await z.recordCardResult(o,{action:n,responseTime:p,sessionType:"comparison"});M.success?(_.value.add(o),n==="remember"?b.value.rememberedCards++:b.value.forgottenCards++):console.error("Failed to record card result:",M.error)}catch(p){console.error("Error handling comparison card action:",p)}}function fe(){setTimeout(()=>{W()},1e3)}async function ge(o){try{await z.skipRetryWait(o);const n=await z.getRetryCards();k.value=n.retryCards}catch(n){console.error("Failed to skip retry:",n)}}async function ve(){try{await z.skipRetryWait(),k.value=[]}catch(o){console.error("Failed to skip all retries:",o)}}async function G(o=null){if(x.value=!0,o)b.value=o;else{const n=await z.completeSession();b.value=n.summary}}function pe(o){const n=Math.floor(o/60),p=o%60;return`${n.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`}async function ye(){try{await K.setAudioSettings({autoPlay:d.value,voice:u.value}),R.value=!1}catch(o){console.error("Failed to save audio settings:",o)}}function U(){t.push("/")}function Y(o){if(!R.value)switch(o.key){case" ":case"Enter":o.preventDefault(),v.value||q();break;case"ArrowUp":case"w":o.preventDefault(),v.value&&r.value&&j(r.value.id,"remember");break;case"ArrowLeft":case"a":o.preventDefault(),v.value&&r.value&&j(r.value.id,"not-remember");break;case"p":o.preventDefault(),V();break}}let H=null;function Ce(){H=setInterval(async()=>{if(k.value.length>0){const o=k.value.map(n=>({...n,remainingTime:Math.max(0,n.remainingTime-1)}));k.value=o.filter(n=>n.remainingTime>0),o.some(n=>n.remainingTime===0)&&await W()}},1e3)}return ke(async()=>{const o=await K.getAudioSettings();d.value=o.autoPlay,u.value=o.voice,await le(),document.addEventListener("keydown",Y),Ce()}),Te(()=>{document.removeEventListener("keydown",Y),H&&clearInterval(H)}),(o,n)=>(C(),y("div",ft,[i("header",gt,[i("div",vt,[i("button",{onClick:U,class:"text-muted-foreground hover:text-foreground"}," â Back "),i("div",pt,[i("div",yt,S(A.value)+"/"+S(E.value),1),i("div",Ct,S(oe.value)+" remaining",1)]),i("button",{onClick:n[0]||(n[0]=p=>R.value=!0),class:"text-muted-foreground hover:text-foreground"}," âï¸ ")])]),i("div",wt,[i("div",{class:"bg-primary h-full transition-all duration-300",style:re({width:`${de.value}%`})},null,4)]),k.value.length>0?(C(),y("div",St,[i("div",bt,[i("span",xt,S(k.value.length)+" card"+S(k.value.length>1?"s":"")+" waiting: "+S(pe(k.value[0].remainingTime)),1),i("div",Rt,[i("button",{onClick:n[1]||(n[1]=p=>ge(k.value[0].cardId)),class:"text-yellow-600 hover:text-yellow-800 font-medium"}," Skip "),i("button",{onClick:ve,class:"text-yellow-600 hover:text-yellow-800 font-medium"}," Skip All ")])])])):N("",!0),i("main",kt,[a.value?(C(),y("div",Tt,[...n[6]||(n[6]=[i("div",{class:"text-lg font-medium mb-2"},"Loading words...",-1),i("div",{class:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto"},null,-1)])])):m.value&&l.value==="comparison"?(C(),y("div",At,[Z(mt,{"word-cards":m.value,"highlighted-card-id":$.value,"revealed-cards":D.value,"completed-cards":_.value,"audio-playing-card-id":g.value,onCardHighlight:ue,onCardReveal:he,onCardAction:me,onAudioPlay:V,onAudioStop:ce,onGroupComplete:fe},null,8,["word-cards","highlighted-card-id","revealed-cards","completed-cards","audio-playing-card-id"])])):r.value&&l.value==="single"?(C(),y("div",Dt,[Z(Ue,{"word-card":r.value,revealed:v.value,"audio-playing":f.value,onAudioPlay:V,onReveal:q,onCardAction:j},null,8,["word-card","revealed","audio-playing"])])):x.value?(C(),y("div",$t,[n[9]||(n[9]=i("div",{class:"text-6xl mb-4"},"ð",-1)),n[10]||(n[10]=i("h2",{class:"text-2xl font-bold mb-4"},"Session Complete!",-1)),i("div",It,[i("div",Pt,[i("div",null,[i("div",zt,S(b.value.rememberedCards),1),n[7]||(n[7]=i("div",{class:"text-sm text-muted-foreground"},"Remembered",-1))]),i("div",null,[i("div",_t,S(b.value.forgottenCards),1),n[8]||(n[8]=i("div",{class:"text-sm text-muted-foreground"},"Forgotten",-1))])]),i("div",Mt,[i("div",null,"Time: "+S(b.value.timeSpent)+" minutes",1),i("div",null,"Avg Response: "+S(b.value.averageResponseTime.toFixed(1))+"s",1),i("div",null,"Streak: "+S(b.value.streak)+" days",1)])]),i("button",{onClick:U,class:"w-full bg-primary text-primary-foreground rounded-md px-4 py-3 font-medium"}," Return to Menu ")])):(C(),y("div",Nt,[n[11]||(n[11]=i("p",{class:"text-muted-foreground mb-4"},"No cards available for study",-1)),i("button",{onClick:U,class:"bg-primary text-primary-foreground rounded-md px-4 py-2"}," Back to Menu ")]))]),R.value?(C(),y("div",Ft,[i("div",Bt,[i("div",Et,[n[12]||(n[12]=i("h3",{class:"text-lg font-semibold"},"Settings",-1)),i("button",{onClick:n[2]||(n[2]=p=>R.value=!1),class:"text-muted-foreground hover:text-foreground"}," â ")]),i("div",Wt,[i("label",Ot,[n[13]||(n[13]=i("span",null,"Auto-play audio",-1)),J(i("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=p=>d.value=p),class:"ml-2"},null,512),[[ee,d.value]])]),i("label",Vt,[n[14]||(n[14]=i("span",null,"Show hints",-1)),J(i("input",{type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=p=>h.value=p),class:"ml-2"},null,512),[[ee,h.value]])]),i("div",Lt,[n[16]||(n[16]=i("label",{class:"block text-sm font-medium"},"Voice",-1)),J(i("select",{"onUpdate:modelValue":n[5]||(n[5]=p=>u.value=p),class:"w-full border rounded-md px-3 py-2 bg-background"},[...n[15]||(n[15]=[i("option",{value:"female"},"Female",-1),i("option",{value:"male"},"Male",-1)])],512),[[Ae,u.value]])])]),i("button",{onClick:ye,class:"w-full bg-primary text-primary-foreground rounded-md px-4 py-2 mt-4"}," Done ")])])):N("",!0)]))}};export{Ht as default};
